!function(){"use strict";!function(){const e="data-webchat-",t="data-webchat-style-",n={bubbleBorderRadius:12,bubbleFromUserBorderRadius:12},a='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 14 10 14 10 20"></polyline><polyline points="20 10 14 10 14 4"></polyline><line x1="14" y1="10" x2="21" y2="3"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>',o='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>',r='<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>';let i=!1;function c(e){return e.replace(/-([a-z])/g,(e,t)=>t.toUpperCase())}function s(...e){const t=getComputedStyle(document.documentElement);for(const n of e){const e=t.getPropertyValue(n).trim();if(e)return e}return null}function d(a){const o={...n},r=s("--primary-color","--accent-color","--brand-color","--color-primary","--theme-primary");r&&(o.accent=r);const i=s("--border-radius","--radius");if(i){const e=parseInt(i,10);isNaN(e)||(o.bubbleBorderRadius=e,o.bubbleFromUserBorderRadius=e)}const d=getComputedStyle(a).fontFamily;d&&"none"!==d&&(o.primaryFont=d);const l=a.getAttribute(`${e}style-options`);l&&window[l]&&Object.assign(o,window[l]);for(const n of a.attributes)if(n.name.startsWith(t)&&n.name!==`${e}style-options`){const e=c(n.name.slice(19));let t=n.value;/^\d+$/.test(t)?t=parseInt(t,10):/^\d+\.\d+$/.test(t)?t=parseFloat(t):"true"===t?t=!0:"false"===t&&(t=!1),o[e]=t}return o}function l(){return new Promise((e,t)=>{if(window.WebChat)return void e();const n=document.createElement("script");n.src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js",n.onload=e,n.onerror=()=>t(new Error("Failed to load WebChat from CDN")),document.head.appendChild(n)})}async function b(e){const t=function(e){const t=e.indexOf("/powervirtualagents");if(-1===t)return null;const n=e.slice(0,t),a=e.match(/api-version=([^&]+)/);return`${n}/powervirtualagents/regionalchannelsettings?api-version=${a?a[1]:"2022-03-01-preview"}`}(e);if(!t)return null;try{const e=await fetch(t);if(!e.ok)return null;const n=await e.json(),a=n.channelUrlsById&&n.channelUrlsById.directline;return a?a.replace(/\/$/,"")+"/v3/directline":null}catch{return null}}async function h(e){const t=await fetch(e);if(!t.ok)throw new Error(`Token fetch failed: ${t.status} ${t.statusText}`);const n=await t.json();if(!n.token)throw new Error('Token endpoint response missing "token" field');return n.token}async function m(t,n,a,o,r){const[i,c]=await Promise.all([h(a),b(a)]),s={token:i};c&&(s.domain=c);const l=window.WebChat.createDirectLine(s),m={directLine:l,styleOptions:d(n)},u=n.getAttribute(`${e}user-id`);u&&(m.userID=u);const p=n.getAttribute(`${e}username`);p&&(m.username=p);const w=n.getAttribute(`${e}locale`);if(w&&(m.locale=w),r){const t=n.getAttribute(`${e}mock-welcome-text`)||n.getAttribute(`${e}mock-welcome`)||"Welcome! How can I help you today?";m.store=window.WebChat.createStore({},({dispatch:e})=>n=>a=>("DIRECT_LINE/CONNECT_FULFILLED"===a.type&&e({type:"DIRECT_LINE/INCOMING_ACTIVITY",payload:{activity:{type:"message",id:"welcome-"+Date.now(),timestamp:(new Date).toISOString(),from:{id:"bot",role:"bot"},text:t}}}),n(a)))}return t.innerHTML="",window.WebChat.renderWebChat(m,t),o&&!r&&l.postActivity({type:"event",name:"startConversation",from:{id:u||"user"}}).subscribe(),l}async function u(t){const n=t.getAttribute(`${e}token-url`);if(!n)return void console.error("webchat-embed: Missing required data-webchat-token-url attribute");!function(){if(i)return;i=!0;const e=document.createElement("style");e.textContent="\n      .webchat-embed-container {\n        display: flex;\n        flex-direction: column;\n        height: 100%;\n        width: 100%;\n        background: #fff;\n      }\n      .webchat-embed-container.minimized {\n        display: none;\n      }\n      .webchat-embed-header {\n        padding: 12px 16px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 16px;\n        font-weight: 600;\n        background: var(--webchat-header-bg, #0078d4);\n        color: var(--webchat-header-color, #ffffff);\n        flex-shrink: 0;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n      }\n      .webchat-embed-header-title {\n        flex: 1;\n      }\n      .webchat-embed-header-actions {\n        display: flex;\n        gap: 8px;\n      }\n      .webchat-embed-header-btn {\n        background: transparent;\n        border: none;\n        color: inherit;\n        cursor: pointer;\n        padding: 4px;\n        border-radius: 4px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        opacity: 0.8;\n        transition: opacity 0.2s, background 0.2s;\n      }\n      .webchat-embed-header-btn:hover {\n        opacity: 1;\n        background: rgba(255,255,255,0.15);\n      }\n      .webchat-embed-chat {\n        flex: 1;\n        min-height: 0;\n      }\n      .webchat-embed-bubble {\n        position: absolute;\n        bottom: 0;\n        right: 0;\n        width: auto;\n        min-width: 60px;\n        height: 60px;\n        border-radius: 30px;\n        background: var(--webchat-header-bg, #0078d4);\n        color: var(--webchat-header-color, #ffffff);\n        border: none;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 8px;\n        padding: 0 20px;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        font-size: 14px;\n        font-weight: 500;\n        box-shadow: 0 4px 20px rgba(0,0,0,0.25);\n        transition: transform 0.2s, box-shadow 0.2s;\n      }\n      .webchat-embed-bubble:hover {\n        transform: scale(1.05);\n        box-shadow: 0 6px 25px rgba(0,0,0,0.3);\n      }\n      .webchat-embed-bubble.hidden {\n        display: none;\n      }\n      .webchat-embed-bubble-icon-only {\n        width: 60px;\n        padding: 0;\n      }\n      .webchat-embed-minimized {\n        background: transparent !important;\n        border: none !important;\n        box-shadow: none !important;\n      }\n      .webchat-embed-minimized > .webchat-embed-container {\n        display: none !important;\n      }\n      .webchat-embed-loading {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        height: 100%;\n        width: 100%;\n      }\n      .webchat-embed-spinner {\n        width: 40px;\n        height: 40px;\n        border: 3px solid #e0e0e0;\n        border-top-color: var(--webchat-header-bg, #0078d4);\n        border-radius: 50%;\n        animation: webchat-spin 0.8s linear infinite;\n      }\n      @keyframes webchat-spin {\n        to { transform: rotate(360deg); }\n      }\n    ",document.head.appendChild(e)}();const c=t.getAttribute(`${e}title`)||"Chat",d=t.getAttribute(`${e}bubble-text`)||"",b="false"!==t.getAttribute(`${e}minimized`),h="true"===t.getAttribute(`${e}preload`),u="false"!==t.getAttribute(`${e}send-start-event`),p=t.hasAttribute(`${e}mock-welcome`),w=s("--primary-color","--accent-color","--brand-color","--color-primary","--theme-primary"),f=t.getAttribute(`${e}header-background`)||t.getAttribute(`${e}style-accent-color`)||w||"#0078d4",g=t.getAttribute(`${e}header-color`)||"#ffffff";let y=b,x=!1;y&&t.classList.add("webchat-embed-minimized");const v=document.createElement("button");if(v.className="webchat-embed-bubble"+(d?"":" webchat-embed-bubble-icon-only"),v.innerHTML=r,d){const e=document.createElement("span");e.textContent=d,v.appendChild(e)}v.style.setProperty("--webchat-header-bg",f),v.style.setProperty("--webchat-header-color",g),v.title="Open chat",y||v.classList.add("hidden");const k=document.createElement("div");k.className="webchat-embed-container";const C=document.createElement("div");C.className="webchat-embed-header",C.style.setProperty("--webchat-header-bg",f),C.style.setProperty("--webchat-header-color",g);const E=document.createElement("span");E.className="webchat-embed-header-title",E.textContent=c;const $=document.createElement("div");$.className="webchat-embed-header-actions";const L=document.createElement("button");L.className="webchat-embed-header-btn",L.innerHTML=o,L.title="Restart conversation";const A=document.createElement("button");function I(e){e.innerHTML=`<div class="webchat-embed-loading"><div class="webchat-embed-spinner" style="--webchat-header-bg: ${f}"></div></div>`}A.className="webchat-embed-header-btn",A.innerHTML=a,A.title="Minimize",$.appendChild(L),$.appendChild(A),C.appendChild(E),C.appendChild($);let N=document.createElement("div");async function M(e=!0){try{await l(),await m(N,t,n,u&&e,p),x=!0}catch(e){console.error("webchat-embed: Initialization failed",e),N.textContent="Failed to load chat. Please refresh the page."}}N.className="webchat-embed-chat",I(N),k.appendChild(C),k.appendChild(N),t.appendChild(v),t.appendChild(k),v.addEventListener("click",function(){y=!1,t.classList.remove("webchat-embed-minimized"),v.classList.add("hidden"),x||M()}),A.addEventListener("click",function(){y=!0,t.classList.add("webchat-embed-minimized"),v.classList.remove("hidden")}),L.addEventListener("click",async function(){const e=N;N=document.createElement("div"),N.className="webchat-embed-chat",I(N),k.replaceChild(N,e);try{await m(N,t,n,u,p)}catch(e){console.error("webchat-embed: Restart failed",e),N.textContent="Failed to restart. Please try again."}}),h?l().then(()=>M(!0)):y||l().then(()=>M(!0))}function p(){document.querySelectorAll(`[${e}token-url]`).forEach(u)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",p):p(),window.WebChatEmbed={init:p,initElement:u}}()}();
